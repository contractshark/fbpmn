# fbpmn

[![Build status](https://secure.travis-ci.org/pascalpoizat/fbpmn.svg)](https://travis-ci.org/pascalpoizat/fbpmn)
[![Windows build status](https://ci.appveyor.com/api/projects/status/github/pascalpoizat/fbpmn?branch=master&svg=true)](https://ci.appveyor.com/project/pascalpoizat/fbpmn)
[![Code Coverage](https://img.shields.io/coveralls/pascalpoizat/fbpmn/master.svg)](https://coveralls.io/github/pascalpoizat/fbpmn)
[![Apache-2.0 license](https://img.shields.io/github/license/pascalpoizat/veca-haskell.svg)](LICENSE)
[![Version](https://img.shields.io/github/tag/pascalpoizat/fbpmn.svg)](fbpmn.cabal)
<br/>
[![Waffle.io - Columns and their card count](https://badge.waffle.io/pascalpoizat/fbpmn.svg?columns=all)](https://waffle.io/pascalpoizat/fbpmn)

<!--
<br/>
[![Hackage](https://img.shields.io/hackage/v/fbpmn.svg)](https://hackage.haskell.org/package/fbpmn)
[![Stackage Lts](http://stackage.org/package/fbpmn/badge/lts)](http://stackage.org/lts/package/fbpmn)
[![Stackage Nightly](http://stackage.org/package/fbpmn/badge/nightly)](http://stackage.org/nightly/package/fbpmn)
-->

formal tools for BPMN

## Requisites

You will need to have `git` installed on your machine to get the source code. See [here](https://git-scm.com/downloads).

You will need to have `stack` installed on your machine to compile the source code (binaries are generated by CI but not saved for use). See [here](https://docs.haskellstack.org/en/stable/README/). For Windows, due to a bug (not related to fbpmn), please use:

```shell
curl -sS -ostack.zip -L --insecure https://www.stackage.org/stack/windows-x86_64
7z x stack.zip stack.exe
```

## Getting source files

```shell
git clone https://github.com/pascalpoizat/fbpmn
```

## Compiling

```shell
cd fbpmn
stack build
stack install
```

This will install the `fbpmn` command in some place that depends on your OS.
You can use `stack path --local-bin` to find out which directory it is.
Do not forget to put this directory in your command path.

### BPMN models

We are currently developping a BPMN-XML (the standard format) to BPMN-JSON (the one we use here) transformation to ease the process.
For the moment, we deal with BPMN models in a BPMN-JSON format as follows:

```json
{
   "containE" : {
      "Sender" : [
         "a",
         "b"
      ],
      "Receiver" : [
         "c",
         "d"
      ]
   },
   "nodes" : [
      "Sender",
      "Receiver",
      "NSE1",
      "NSE2",
      "ST1",
      "RT2",
      "NEE1",
      "NEE2"
   ],
   "sourceE" : {
      "a" : "NSE1",
      "d" : "RT2",
      "m" : "ST1",
      "c" : "NSE2",
      "b" : "ST1"
   },
   "edges" : [
      "a",
      "b",
      "c",
      "d",
      "m"
   ],
   "targetE" : {
      "c" : "RT2",
      "b" : "NEE1",
      "a" : "ST1",
      "d" : "NEE2",
      "m" : "RT2"
   },
   "nameN" : {},
   "catE" : {
      "c" : "NormalSequenceFlow",
      "b" : "NormalSequenceFlow",
      "a" : "NormalSequenceFlow",
      "d" : "NormalSequenceFlow",
      "m" : "MessageFlow"
   },
   "messageN" : {
      "ST1" : [
         "message"
      ],
      "RT2" : [
         "message"
      ]
   },
   "containN" : {
      "Sender" : [
         "NSE1",
         "ST1",
         "NEE1"
      ],
      "Receiver" : [
         "NSE2",
         "RT2",
         "NEE2"
      ]
   },
   "name" : "g0",
   "catN" : {
      "ST1" : "SendTask",
      "RT2" : "ReceiveTask",
      "NEE2" : "NoneEndEvent",
      "NSE1" : "NoneStartEvent",
      "Sender" : "Process",
      "NSE2" : "NoneStartEvent",
      "NEE1" : "NoneEndEvent",
      "Receiver" : "Process"
   },
   "messages" : [
      "message"
   ]
}
```


## Generating the TLA+ representation of a BPMN model

`fbpmn` is a REPL that understands the following commands:

- load <path>: load current graph from file (JSON format) and verify it
- tla <path>: save current graph to file (TLA+ format)
- quit: quit
  
To transform a BPMN model (in our JSON format) into TLA+ for verification, then do:

1. run `fbpmn`
2. load your file using `load <filepath>`
3. save your file using `tla <filepath>`
4. quit using `quit`

If needed there are small models inlined with the source that can be used to generate a template BPMN model in JSON format.
For this do:

1. run `fbpmn`
2. list internal models using `list`
3. import one of them using `import <modelname>`
4. save it in JSON format using `json <filepath>`
5. quit using `quit`

If you find the JSON output is hard to read, you may use:

```shell
json_pp -f json -t json < filename
```

To render it more nicely before edition.

## Verification

For verification you will need 
- the TLA+ toolbox: [http://lamport.azurewebsites.net/tla/tla.html](http://lamport.azurewebsites.net/tla/tla.html),
- the TLA+ theories files available here: [http://pardi.enseeiht.fr/FormaliSE19/](http://pardi.enseeiht.fr/FormaliSE19/).

(practical session with the TLA+ toolbox to be described)

